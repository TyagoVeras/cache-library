"use strict";var K=Object.create;var y=Object.defineProperty;var N=Object.getOwnPropertyDescriptor;var j=Object.getOwnPropertyNames;var x=Object.getPrototypeOf,T=Object.prototype.hasOwnProperty;var D=(e,t)=>{for(var o in t)y(e,o,{get:t[o],enumerable:!0})},S=(e,t,o,c)=>{if(t&&typeof t=="object"||typeof t=="function")for(let n of j(t))!T.call(e,n)&&n!==o&&y(e,n,{get:()=>t[n],enumerable:!(c=N(t,n))||c.enumerable});return e};var g=(e,t,o)=>(o=e!=null?K(x(e)):{},S(t||!e||!e.__esModule?y(o,"default",{value:e,enumerable:!0}):o,e)),J=e=>S(y({},"__esModule",{value:!0}),e);var k={};D(k,{cacheInjectable:()=>U});module.exports=J(k);var V=require("reflect-metadata");var u=g(require("fs")),I=g(require("path"));function $(e){if(!e.defaultRootKey)throw new Error("Default root key is not defined");if(e.strategy==="redis"&&!e.connectionUrl)throw new Error("Redis connection URL is not defined")}var E=I.resolve(u.realpathSync(process.cwd()),"cache-config.json"),F=u.readFileSync(E,"utf-8"),p=JSON.parse(F);$(p);var i={strategy:p.strategy,connectionUrl:p.connectionUrl,defaultRootKey:p.defaultRootKey,defaultTtl:3600};var b=g(require("node-cache")),d=class{constructor(){this.cache=new b.default}async get(t){return this.cache.get(t)}async set(t,o,c){this.cache.set(t,o,c/1e3)}};var P=g(require("ioredis"));var m=class{constructor(){if(!i.connectionUrl)throw new Error("Redis connection URL is not defined");this.cache=new P.default(i.connectionUrl)}async get(t){let o=await this.cache.get(t);return o?JSON.parse(o):null}async set(t,o,c){await this.cache.set(t,JSON.stringify(o),"PX",c)}};var l,M={"node-cache":d,redis:m};l=new M[i.strategy];function O(e,t){return`${e}:${JSON.stringify(t)}`}function U({cacheKey:e,ttl:t}){return function(o,c,n){let C=`${i.defaultRootKey}:${e}`,w=t||i.defaultTtl;if(n&&c){let h=n.value;n.value=async function(...r){let s=O(C,r),f=await l.get(s);if(f)return console.log("Returning cached value for",s),f;let a=await h.apply(this,r);return await l.set(s,a,w),console.log("Caching value for",s),a}}else for(let h of Object.getOwnPropertyNames(o.prototype)){let r=Object.getOwnPropertyDescriptor(o.prototype,h);if(r&&r.value instanceof Function){let s=r.value;r.value=async function(...f){let a=O(C,f),v=await l.get(a);if(v)return console.log("Returning cached value for",a),v;let R=await s.apply(this,f);return await l.set(a,R,w),console.log("Caching value for",a),R},Object.defineProperty(o.prototype,h,r)}}}}0&&(module.exports={cacheInjectable});
